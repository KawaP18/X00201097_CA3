trigger:
  branches:
    include:
      - development
      - main

stages:
# =========================
# BUILD STAGE
# =========================
- stage: Build
  displayName: Build Stage
  jobs:
    - job: BuildJob
      displayName: Build
      pool:
        vmImage: ubuntu-latest
      steps:
        - checkout: self

        - task: UsePythonVersion@0
          inputs:
            versionSpec: '3.11'

        - script: |
            python -m pip install --upgrade pip
            pip install -r requirements.txt
          displayName: Install dependencies

# =========================
# DEPLOY TO TEST
# =========================
- stage: Deploy_Test
  displayName: Deploy to Test
  dependsOn: Build
  condition: and(succeeded(), eq(variables['Build.SourceBranch'], 'refs/heads/development'))
  jobs:
    - deployment: DeployTest
      displayName: Deploy to Test Environment
      environment: Test
      strategy:
        runOnce:
          deploy:
            steps:
              - script: |
                  echo "Deploying application to TEST environment"
                  echo "Environment: $(ENVIRONMENT)"
                displayName: Test deployment step

# =========================
# DEPLOY TO PRODUCTION
# =========================
- stage: Deploy_Production
  displayName:
